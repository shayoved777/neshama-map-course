import streamlit as st
import random
from datetime import datetime
from pyluach import dates

# ×”×’×“×¨×ª ×›×•×ª×¨×ª, ××™×™×§×•×Ÿ ×•×”×¤×¨×™×¡×”
st.set_page_config(
    page_title="××¤×ª ×”× ×©××” ×©×œ×š",
    page_icon="ğŸŒŸ",
    layout="centered",
)

# ×¢×™×¦×•×‘ ×‘×¡×™×¡×™ ×‘×˜×§×¡×˜ (CSS) ×‘×’×•×•× ×™ ×›×—×•×œ ×•×–×”×‘
page_bg = """
<style>
body {
    background: linear-gradient(to bottom right, #01295F, #6E6E6D);
    color: #FFD700;
    font-family: Arial, sans-serif;
}
h1, h2, h3, h4 {
    color: #FFD700;
}
div.stForm {
    background-color: rgba(255, 215, 0, 0.2);
    padding: 20px;
    border-radius: 12px;
}
div.stForm button {
    background-color: #014f86 !important;
    border: none;
    color: #FFD700 !important;
    font-size: 16px;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
}
div.stForm button:hover {
    background-color: #013567 !important;
}
</style>
"""
st.markdown(page_bg, unsafe_allow_html=True)

# ×¨×©×™××•×ª ×œ×©×™××•×© ×‘××¤×”
mazalot = [
    '×˜×œ×”', '×©×•×¨', '×ª××•××™×', '×¡×¨×˜×Ÿ',
    '××¨×™×”', '×‘×ª×•×œ×”', '×××–× ×™×™×', '×¢×§×¨×‘',
    '×§×©×ª', '×’×“×™', '×“×œ×™', '×“×’×™×'
]

sfirot = [
    '×›×ª×¨', '×—×›××”', '×‘×™× ×”', '×—×¡×“', '×’×‘×•×¨×”',
    '×ª×¤××¨×ª', '× ×¦×—', '×”×•×“', '×™×¡×•×“', '××œ×›×•×ª'
]

psukim = {
    '×›×ª×¨':   ['"×‘×¨××©×™×ª ×‘×¨× ××œ×•×”×™× ××ª ×”×©××™× ×•××ª ×”××¨×¥" (×‘×¨××©×™×ª ××³)'],
    '×—×›××”':  ['"×”×³ ×‘×—×›××” ×™×¡×“ ××¨×¥" (××©×œ×™ ×’×³)'],
    '×‘×™× ×”':  ['"×•×ª×‘×•× ×” ×‘×©××™×" (××™×•×‘ ×›×—)'],
    '×—×¡×“':   ['"×¢×•×œ× ×—×¡×“ ×™×‘× ×”" (×ª×”×™×œ×™× ×¤×´×˜)', '"×—×¡×“×™ ×”×³ ×›×™ ×œ× ×ª×× ×•" (××™×›×” ×’×³)'],
    '×’×‘×•×¨×”': ['"××–×•×¨ ×‘×’×‘×•×¨×” ××ª× ×™×š" (××™×•×‘ ×œ×—)', '"×”×³ ×¢×•×– ×œ×¢××• ×™×ª×Ÿ" (×ª×”×™×œ×™× ×›×´×˜)'],
    '×ª×¤××¨×ª': ['"×•×”×“×¨×ª ×¤× ×™ ×–×§×Ÿ" (×•×™×§×¨× ×™×´×˜)', '"×¤××¨ ×ª×—×ª ××¤×¨" (×™×©×¢×™×”×• ×¡×´×)'],
    '× ×¦×—':   ['"×•×’× × ×¦×— ×™×©×¨××œ ×œ× ×™×©×§×¨" (×©××•××œ ××³ ×˜×´×•)', '"× ×¦×—×•× ×™ ×‘× ×™ × ×¦×—×•× ×™" (×‘×´× × ×˜)'],
    '×”×•×“':   ['"×”×•×“ ×•×”×“×¨ ×œ×¤× ×™×•" (×“×‘×¨×™ ×”×™××™× ××³ ×˜×´×–)', '"×”×•×“×™ × ×”×¤×š ×¢×œ×™ ×œ××©×—×™×ª" (×“× ×™××œ ×™×³)'],
    '×™×¡×•×“':  ['"×¦×“×™×§ ×™×¡×•×“ ×¢×•×œ×" (××©×œ×™ ×™×³)', '"×•×¡×•×œ× ××•×¦×‘ ××¨×¦×” ×•×¨××©×• ××’×™×¢ ×”×©××™××”" (×‘×¨××©×™×ª ×›×—)'],
    '××œ×›×•×ª': ['"×•××œ×›×•×ª×• ×‘×›×œ ××©×œ×”" (×ª×”×™×œ×™× ×§×´×’)', '"××œ×›×•×ª×š ××œ×›×•×ª ×›×œ ×¢×•×œ××™×" (×ª×”×™×œ×™× ×§××´×”)']
}

traits = {
    '×˜×œ×”': '×™×¦×™×¨×ª×™×•×ª, ×× ×”×™×’×•×ª, ×”×ª×—×œ×” ×—×“×©×”',
    '×©×•×¨': '×™×¦×™×‘×•×ª, ×”×ª××“×”, ×—×•×©× ×™×•×ª',
    '×ª××•××™×': '×ª×§×©×•×¨×ª, ×’××™×©×•×ª, ×¡×§×¨× ×•×ª',
    '×¡×¨×˜×Ÿ': '×¨×’×™×©×•×ª, ×××¤×ª×™×”, ×‘×™×ª×™×•×ª',
    '××¨×™×”': '× ×“×™×‘×•×ª, ×›×¨×™×–××”, ×‘×™×˜×—×•×Ÿ ×¢×¦××™',
    '×‘×ª×•×œ×”': '×“×™×™×§× ×•×ª, ×× ×œ×™×˜×™×•×ª, ××—×¨×™×•×ª',
    '×××–× ×™×™×': '×”×¨××•× ×™×”, ××™×–×•×Ÿ, ×™×•×¤×™',
    '×¢×§×¨×‘': '×¢×•××§, ×ª×©×•×§×”, ××™× ×˜×•××™×¦×™×”',
    '×§×©×ª': '×”×¨×¤×ª×§× ×•×ª, ×—×•×¤×©, ××•×¤×˜×™××™×•×ª',
    '×’×“×™': '×©××¤×ª× ×•×ª, ××©××¢×ª, ××—×¨×™×•×ª',
    '×“×œ×™': '××§×•×¨×™×•×ª, ×—×“×©× ×•×ª, ××™×“×™××œ×™×–×',
    '×“×’×™×': '×¨×•×—× ×™×•×ª, ×“××™×•×Ÿ, ×—××œ×”'
}

def get_mazal(hebrew_month):
    return mazalot[hebrew_month - 1]

def get_sfira(hebrew_month):
    return sfirot[(hebrew_month - 1) % len(sfirot)]

def generate_teaser(name, mother, birthdate, question):
    date = datetime.strptime(str(birthdate), "%Y-%m-%d")
    heb_date = dates.HebrewDate.from_pydate(date)
    mazal = get_mazal(heb_date.month)
    sfira = get_sfira(heb_date.month)
    pasuk = random.choice(psukim[sfira])
    midot = traits[mazal]

    msg = f'''
**×©×œ×•× {name} ×‘×Ÿ/×‘×ª {mother},**
× ×•×œ×“×ª ×‘Ö¾**{heb_date}** ({birthdate.strftime("%d/%m/%Y")})

**××–×œ×š** ×”×•× **{mazal}** â€“ {midot}  
**×©×•×¨×© × ×©××ª×š** ×‘×¡×¤×™×¨×ª **{sfira}**  
**×”×¤×¡×•×§ ×©×œ×š:** {pasuk}

×”×©××œ×” ×©×©××œ×ª: "{question}"

×™×© ×¢×•×“ ×¢×•××§ ×©×œ× × ×’×œ×” ×›××Ÿ.  
×§×‘×œ ××ª ××¤×ª ×”× ×©××” ×”××œ××” â€“ ×”×›×•×œ×œ×ª ×”×¡×‘×¨×™× ××”×§×‘×œ×”, ×”×–×•×”×¨ ×•×”××¨×´×™.

[ğŸ”“ ×œ×—×¦×• ×›××Ÿ ×œ×¨×›×™×©×” >>]
'''
    return msg

# ×›×•×ª×¨×ª ×¨××©×™×ª
st.markdown("<h1 style='text-align: center;'>××¤×ª ×”× ×©××” ×”×—×™× ××™×ª</h1>", unsafe_allow_html=True)

# ×”×¡×‘×¨ ×§×¦×¨
st.markdown("#### ××œ× ××ª ×¤×¨×˜×™×š, ×•×”××¢×¨×›×ª ×ª×¤×™×§ ×¢×‘×•×¨×š ×ª×©×•×‘×” ××•×ª×××ª ××™×©×™×ª:")

with st.form("soul_form"):
    name = st.text_input("×©× ×¤×¨×˜×™")
    mother = st.text_input("×©× ×”××")
    birthdate = st.date_input(
    "×ª××¨×™×š ×œ×™×“×”",
    min_value=datetime(1900, 1, 1),
    max_value=datetime.today()
)
    question = st.text_area("×©××œ×” ×¤×ª×•×—×” ×©××¢×¡×™×§×” ××•×ª×š")
    submitted = st.form_submit_button("×©×œ×— ×•×§×‘×œ ×ª×©×•×‘×” ×—×™× ××™×ª")

if submitted:
    if not name or not mother:
        st.error("×× × ××œ× ×’× ×©× ×¤×¨×˜×™ ×•×’× ×©× ×”××.")
    else:
        result = generate_teaser(name, mother, birthdate, question)
        st.info(result)

