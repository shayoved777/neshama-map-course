
import streamlit as st
import random
from datetime import datetime
from pyluach import dates

st.set_page_config(
    page_title="××¤×ª ×”× ×©××” ×©×œ×š",
    page_icon="ğŸŒŸ",
    layout="centered",
)

mazalot = ['×˜×œ×”', '×©×•×¨', '×ª××•××™×', '×¡×¨×˜×Ÿ', '××¨×™×”', '×‘×ª×•×œ×”', '×××–× ×™×™×', '×¢×§×¨×‘', '×§×©×ª', '×’×“×™', '×“×œ×™', '×“×’×™×']
sfirot = ['×›×ª×¨', '×—×›××”', '×‘×™× ×”', '×—×¡×“', '×’×‘×•×¨×”', '×ª×¤××¨×ª', '× ×¦×—', '×”×•×“', '×™×¡×•×“', '××œ×›×•×ª']

psukim = {
    '×›×ª×¨': ['×‘×¨××©×™×ª ×‘×¨× ××œ×•×”×™× ××ª ×”×©××™× ×•××ª ×”××¨×¥ (×‘×¨××©×™×ª ×\')'],
    '×—×›××”': ['"×”×³ ×‘×—×›××” ×™×¡×“ ××¨×¥" (××©×œ×™ ×’')'],
    '×‘×™× ×”': ['"×•×ª×‘×•× ×” ×‘×©××™×" (××™×•×‘ ×›"×—)'],
    '×—×¡×“': ['"×¢×•×œ× ×—×¡×“ ×™×‘× ×”" (×ª×”×™×œ×™× ×¤"×˜)', '"×—×¡×“×™ ×”×³ ×›×™ ×œ× ×ª×× ×•" (××™×›×” ×’')'],
    '×’×‘×•×¨×”': ['"××–×•×¨ ×‘×’×‘×•×¨×” ××ª× ×™×š" (××™×•×‘ ×œ"×—)', '"×”×³ ×¢×•×– ×œ×¢××• ×™×ª×Ÿ" (×ª×”×™×œ×™× ×›"×˜)'],
    '×ª×¤××¨×ª': ['"×•×”×“×¨×ª ×¤× ×™ ×–×§×Ÿ" (×•×™×§×¨× ×™"×˜)', '"×¤××¨ ×ª×—×ª ××¤×¨" (×™×©×¢×™×”×• ×¡"×)'],
    '× ×¦×—': ['"×•×’× × ×¦×— ×™×©×¨××œ ×œ× ×™×©×§×¨" (×©××•××œ ××³ ×˜"×•)', '"× ×¦×—×•× ×™ ×‘× ×™ × ×¦×—×•× ×™" (×‘×‘× ××¦×™×¢× × "×˜)'],
    '×”×•×“': ['"×”×•×“ ×•×”×“×¨ ×œ×¤× ×™×•" (×“×‘×¨×™ ×”×™××™× ××³ ×˜×´×–)', '"×”×•×“×™ × ×”×¤×š ×¢×œ×™ ×œ××©×—×™×ª" (×“× ×™××œ ×™')'],
    '×™×¡×•×“': ['"×¦×“×™×§ ×™×¡×•×“ ×¢×•×œ×" (××©×œ×™ ×™')', '"×•×¡×•×œ× ××•×¦×‘ ××¨×¦×” ×•×¨××©×• ××’×™×¢ ×”×©××™××”" (×‘×¨××©×™×ª ×›"×—)'],
    '××œ×›×•×ª': ['"×•××œ×›×•×ª×• ×‘×›×œ ××©×œ×”" (×ª×”×™×œ×™× ×§"×’)', '"××œ×›×•×ª×š ××œ×›×•×ª ×›×œ ×¢×•×œ××™×" (×ª×”×™×œ×™× ×§×"×”)']
}

traits = {
    '×˜×œ×”': '×™×¦×™×¨×ª×™×•×ª, ×× ×”×™×’×•×ª, ×”×ª×—×œ×” ×—×“×©×”',
    '×©×•×¨': '×™×¦×™×‘×•×ª, ×”×ª××“×”, ×—×•×©× ×™×•×ª',
    '×ª××•××™×': '×ª×§×©×•×¨×ª, ×’××™×©×•×ª, ×¡×§×¨× ×•×ª',
    '×¡×¨×˜×Ÿ': '×¨×’×™×©×•×ª, ×××¤×ª×™×”, ×‘×™×ª×™×•×ª',
    '××¨×™×”': '× ×“×™×‘×•×ª, ×›×¨×™×–××”, ×‘×™×˜×—×•×Ÿ ×¢×¦××™',
    '×‘×ª×•×œ×”': '×“×™×™×§× ×•×ª, ×× ×œ×™×˜×™×•×ª, ××—×¨×™×•×ª',
    '×××–× ×™×™×': '×”×¨××•× ×™×”, ××™×–×•×Ÿ, ×™×•×¤×™',
    '×¢×§×¨×‘': '×¢×•××§, ×ª×©×•×§×”, ××™× ×˜×•××™×¦×™×”',
    '×§×©×ª': '×”×¨×¤×ª×§× ×•×ª, ×—×•×¤×©, ××•×¤×˜×™××™×•×ª',
    '×’×“×™': '×©××¤×ª× ×•×ª, ××©××¢×ª, ××—×¨×™×•×ª',
    '×“×œ×™': '××§×•×¨×™×•×ª, ×—×“×©× ×•×ª, ××™×“×™××œ×™×–×',
    '×“×’×™×': '×¨×•×—× ×™×•×ª, ×“××™×•×Ÿ, ×—××œ×”'
}

def get_mazal(hebrew_month):
    return mazalot[hebrew_month - 1]

def get_sfira(hebrew_month):
    return sfirot[(hebrew_month - 1) % len(sfirot)]

def generate_teaser(name, mother, birthdate, question):
    date = datetime.strptime(str(birthdate), "%Y-%m-%d")
    heb = dates.HebrewDate.from_pydate(date)
    mazal = get_mazal(heb.month)
    sfira = get_sfira(heb.month)
    pasuk = random.choice(psukim[sfira])
    midot = traits[mazal]

    msg = f""" 
âœ¨ ×©×œ×•× {name} ×‘×Ÿ/×‘×ª {mother}, × ×•×œ×“×ª ×‘-{heb} ({birthdate.strftime("%d/%m/%Y")})
ğŸ”¯ ××–×œ×š ×”×•× {mazal} â€“ {midot}
ğŸŒ¿ ×©×•×¨×© × ×©××ª×š ×‘×¡×¤×™×¨×ª {sfira}
ğŸ•¯ ×”×¤×¡×•×§ ×©×œ×š: {pasuk}
â“ ×”×©××œ×” ×©×©××œ×ª: "{question}"

ğŸ“Œ ×™×© ×¢×•×“ ×¢×•××§ ×©×œ× × ×’×œ×” ×›××Ÿ.
ğŸ“¥ ×§×‘×œ ××ª ××¤×ª ×”× ×©××” ×”××œ××” â€“ ×”×›×•×œ×œ×ª ×”×¡×‘×¨×™× ××”×§×‘×œ×”, ×”×–×•×”×¨ ×•×”××¨×´×™.

[ ğŸ”“ ×œ×—×¦×• ×›××Ÿ ×œ×¨×›×™×©×” >> ]
"""
    return msg

st.markdown("<h1 style='text-align: center;'>××¤×ª ×”× ×©××” ×”×—×™× ××™×ª</h1>", unsafe_allow_html=True)
st.markdown("### ××œ× ××ª ×¤×¨×˜×™×š ×•×”××¢×¨×›×ª ×ª×¤×™×§ ×¢×‘×•×¨×š ×ª×©×•×‘×” ××•×ª×××ª ××™×©×™×ª:")

with st.form("soul_form"):
    name = st.text_input("×©× ×¤×¨×˜×™")
    mother = st.text_input("×©× ×”××")
    birthdate = st.date_input("×ª××¨×™×š ×œ×™×“×”")
    question = st.text_area("×©××œ×” ×¤×ª×•×—×” ×©××¢×¡×™×§×” ××•×ª×š")
    submitted = st.form_submit_button("×©×œ×— ×•×§×‘×œ ×ª×©×•×‘×” ×—×™× ××™×ª")

if submitted:
    result = generate_teaser(name, mother, birthdate, question)
    st.success(result)
